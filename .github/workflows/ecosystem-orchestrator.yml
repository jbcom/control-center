---
# .github/workflows/ecosystem-orchestrator.yml

name: Ecosystem Orchestrator

on:
  pull_request:
    types: [opened, synchronize, ready_for_review]
  issue_comment:
    types: [created]
  workflow_run:
    workflows: ["CI", "Build", "Test", "Lint"]
    types: [completed]
  workflow_call:
    inputs:
      action:
        description: 'Action: review, delegate'
        required: true
        type: string
      pr_number:
        description: 'PR number for review'
        required: false
        type: number
      model_tier:
        description: 'Model tier: ollama, claude, jules'
        required: false
        type: string
        default: 'ollama'
      comment_body:
        description: 'Comment body for delegation'
        required: false
        type: string
      issue_number:
        description: 'Issue number'
        required: false
        type: number
      issue_title:
        description: 'Issue title'
        required: false
        type: string
      issue_body:
        description: 'Issue body'
        required: false
        type: string
      default_branch:
        description: 'Default branch'
        required: false
        type: string
        default: 'main'
      repository:
        description: 'Target repository'
        required: true
        type: string
    secrets:
      CI_GITHUB_TOKEN:
        required: true
      ANTHROPIC_API_KEY:
        required: false
      GOOGLE_JULES_API_KEY:
        required: false
      OLLAMA_API_KEY:
        required: false
      CURSOR_API_KEY:
        required: false

permissions:
  contents: write
  pull-requests: write
  issues: write
  actions: write

jobs:
  orchestrate:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run Orchestrator
        uses: jbcom/agentic-orchestrator@v1
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          jules_api_key: ${{ secrets.GOOGLE_JULES_API_KEY }}
          cursor_api_key: ${{ secrets.CURSOR_API_KEY }}
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          ollama_api_key: ${{ secrets.OLLAMA_API_KEY }}
