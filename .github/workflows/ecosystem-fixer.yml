name: Ecosystem Fixer

# CI failure auto-resolution using @agentic/control

on:
  workflow_run:
    workflows: ["CI"]
    types: [completed]
    branches-ignore: [main]

permissions:
  contents: write
  pull-requests: write
  actions: read

jobs:
  fix:
    name: Auto-resolve CI Failures
    if: github.event.workflow_run.conclusion == 'failure'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1
        with:
          ref: ${{ github.event.workflow_run.head_branch }}
          fetch-depth: 0

      - name: CI Resolution
        uses: jbcom/nodejs-agentic-control/actions/agentic-ci-resolution@main
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          run_id: ${{ github.event.workflow_run.id }}
