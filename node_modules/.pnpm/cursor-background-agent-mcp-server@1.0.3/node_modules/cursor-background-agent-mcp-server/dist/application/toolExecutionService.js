"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.CursorToolExecutionService = void 0;
const domain_1 = require("../domain");
class CursorToolExecutionService {
    constructor(cursorClient) {
        this.cursorClient = cursorClient;
    }
    async execute(tool, input) {
        switch (tool) {
            case "launchAgent": {
                const data = input;
                const repo = data?.source?.repository;
                const ref = data?.source?.ref;
                const repoPattern = /^https:\/\/github\.com\/[^/]+\/[^/]+$/;
                if (typeof repo !== "string" || !repoPattern.test(repo)) {
                    throw new domain_1.MCPErrorImpl(domain_1.MCP_ERROR_CODES.INVALID_INPUT, "Invalid source.repository. Use a full GitHub URL like https://github.com/owner/repo and ensure the Cursor GitHub App is installed on the repository.", { field: "source.repository", example: "https://github.com/owner/repo" });
                }
                if (typeof ref !== "string" || ref.trim().length === 0) {
                    throw new domain_1.MCPErrorImpl(domain_1.MCP_ERROR_CODES.INVALID_INPUT, "Missing source.ref. Provide a branch or commit reference (e.g., 'main').", { field: "source.ref", example: "main" });
                }
                return this.cursorClient.launchAgent(input);
            }
            case "listAgents":
                return this.cursorClient.listAgents();
            case "listModels":
                return this.cursorClient.listModels();
            case "addFollowup":
                const followupInput = input;
                return this.cursorClient.addFollowup(followupInput.agentId, { prompt: followupInput.prompt });
            case "getAgentConversation":
                const conversationInput = input;
                return this.cursorClient.getAgentConversation(conversationInput.agentId);
            case "getAgentStatus":
                const statusInput = input;
                return this.cursorClient.getAgentStatus(statusInput.agentId);
            case "listRepositories":
                return this.cursorClient.listRepositories();
            default:
                throw new Error(`Unknown tool: ${tool}`);
        }
    }
}
exports.CursorToolExecutionService = CursorToolExecutionService;
//# sourceMappingURL=toolExecutionService.js.map