#!/bin/bash
# CLI wrapper for AWS Billing & Cost Management MCP server via mcp-proxy
# Usage: billing-cost <tool_name> [arguments_json]
# Example: billing-cost get_monthly_costs '{"start_date": "2025-11-01"}'

set -e

MCP_PROXY_URL="${MCP_PROXY_BILLING_COST_URL:-http://localhost:3008}"
TOOL_NAME="$1"
ARGS_JSON="${2:-{}}"

if [ -z "$TOOL_NAME" ]; then
  echo "Usage: billing-cost <tool_name> [arguments_json]"
  echo ""
  echo "Available tools:"
  curl -s "${MCP_PROXY_URL}/list-tools" | jq -r '.tools[] | "  - \(.name): \(.description)"'
  exit 1
fi

RESPONSE=$(curl -sf -X POST "${MCP_PROXY_URL}/call-tool" \
  -H "Content-Type: application/json" \
  -d "{\"name\": \"${TOOL_NAME}\", \"arguments\": ${ARGS_JSON}}" 2>&1)

if [ $? -ne 0 ]; then
  echo "âŒ Error calling MCP proxy: ${RESPONSE}" >&2
  exit 1
fi

echo "$RESPONSE" | jq -r '.content[0].text // .error // .'
