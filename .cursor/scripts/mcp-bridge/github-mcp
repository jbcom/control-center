#!/bin/bash
# CLI wrapper for GitHub MCP server via mcp-proxy
# Usage: github-mcp <tool_name> [arguments_json]
# Example: github-mcp list_issues '{"owner": "jbcom", "repo": "extended-data-types"}'

set -e

MCP_PROXY_URL="${MCP_PROXY_GITHUB_URL:-http://localhost:3010}"
TOOL_NAME="$1"
ARGS_JSON="${2:-{}}"

if [ -z "$TOOL_NAME" ]; then
  echo "Usage: github-mcp <tool_name> [arguments_json]"
  echo ""
  echo "Available tools:"
  curl -s "${MCP_PROXY_URL}/list-tools" | jq -r '.tools[] | "  - \(.name): \(.description)"'
  exit 1
fi

RESPONSE=$(curl -sf -X POST "${MCP_PROXY_URL}/call-tool" \
  -H "Content-Type: application/json" \
  -d "{\"name\": \"${TOOL_NAME}\", \"arguments\": ${ARGS_JSON}}" 2>&1)

if [ $? -ne 0 ]; then
  echo "âŒ Error calling MCP proxy: ${RESPONSE}" >&2
  exit 1
fi

echo "$RESPONSE" | jq -r '.content[0].text // .error // .'
