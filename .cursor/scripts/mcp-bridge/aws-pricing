#!/bin/bash
# CLI wrapper for AWS Pricing MCP server via mcp-proxy
# Usage: aws-pricing <tool_name> [arguments_json]
# Example: aws-pricing get_price '{"service": "EC2", "instance_type": "t3.micro"}'

set -e

MCP_PROXY_URL="${MCP_PROXY_AWS_PRICING_URL:-http://localhost:3007}"
TOOL_NAME="$1"
ARGS_JSON="${2:-{}}"

if [ -z "$TOOL_NAME" ]; then
  echo "Usage: aws-pricing <tool_name> [arguments_json]"
  echo ""
  echo "Available tools:"
  curl -s "${MCP_PROXY_URL}/list-tools" | jq -r '.tools[] | "  - \(.name): \(.description)"'
  exit 1
fi

RESPONSE=$(curl -sf -X POST "${MCP_PROXY_URL}/call-tool" \
  -H "Content-Type: application/json" \
  -d "{\"name\": \"${TOOL_NAME}\", \"arguments\": ${ARGS_JSON}}" 2>&1)

if [ $? -ne 0 ]; then
  echo "âŒ Error calling MCP proxy: ${RESPONSE}" >&2
  exit 1
fi

echo "$RESPONSE" | jq -r '.content[0].text // .error // .'
