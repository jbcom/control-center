# Message 179 - ü§ñ Assistant

**ID**: 74145c3c-7367-4e26-b716-8f4f7b5eedcb
**Type**: assistant_message


---

**Simplified!** The workflow now uses the Doppler-inspired pattern:

```yaml
env:
  ALL_SECRETS: ${{ toJson(secrets) }}  # ‚Üê The magic!
```

## How It Works

1. **`toJson(secrets)`** dumps ALL secret values as JSON
2. **`jq`** filters/transforms (excludes `github_token`, uppercases keys)
3. **`gh api`** gets target org's public key
4. **Python nacl** encrypts each secret value
5. **`gh api PUT`** sets the secret in target org

## Usage

```bash
# Dry run (default) - see what would sync
gh workflow run "Enterprise Secrets Safety Valve" \
  --repo FlipsideCrypto/terraform-modules \
  -f target_orgs="fsc-internal-tooling-administration"

# Actually sync secrets
gh workflow run "Enterprise Secrets Safety Valve" \
  --repo FlipsideCrypto/terraform-modules \
  -f target_orgs="fsc-internal-tooling-administration" \
  -f dry_run=false

# Sync specific secrets only
gh workflow run "Enterprise Secrets Safety Valve" \
  --repo FlipsideCrypto/terraform-modules \
  -f target_orgs="fsc-internal-tooling-administration" \
  -f secrets_filter="DOPPLER_TOKEN,VAULT_URL,VAULT_NAMESPACE" \
  -f dry_run=false

# Sync to ALL enterprise orgs
gh workflow run "Enterprise Secrets Safety Valve" \
  --repo FlipsideCrypto/terraform-modules \
  -f target_orgs="all" \
  -f dry_run=false
```

The Python module is still there for programmatic use, but the workflow is now self-contained and much cleaner.

**PR**: https://github.com/FlipsideCrypto/terraform-modules/pull/206
