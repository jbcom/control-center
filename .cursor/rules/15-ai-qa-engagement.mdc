---
alwaysApply: true
description: MANDATORY AI code review engagement protocol - agents MUST engage QA before merge
globs: ["**/*"]
---

# AI Code Review (QA) Engagement

## üö® CRITICAL: Mandatory Review Before Merge

**NEVER merge a PR without:**
1. Requesting AI review from at least ONE QA agent
2. Waiting for the review to complete
3. FULLY addressing ALL feedback (not just dismissing it)
4. Documenting your response to each piece of feedback

## How to Request Review

Post these commands as PR comments to engage AI reviewers:

```
/gemini review       # Google Gemini Code Assist
/q review            # Amazon Q Developer
@copilot review      # GitHub Copilot
@cursor review       # Cursor AI review
@coderabbitai review # CodeRabbit AI review
```

### Focused Reviews

Request specific review types:
```
/gemini review security     # Security-focused review
/q review performance       # Performance analysis
@copilot review tests       # Test coverage review
@cursor review architecture # Architecture review
```

## Scope: When This Protocol Applies

### MANDATORY Review Required:
- **All PRs with code changes** (Python, TypeScript, etc.)
- Bug fixes (even "simple" ones with tests)
- New features and enhancements
- Refactors (any size)
- Dependency updates that modify lock files or affect code
- Security-related changes
- API changes (breaking or non-breaking)
- Configuration changes that affect runtime behavior

### Review NOT Required (explicit exceptions):
- **Pure Markdown/documentation changes** - README.md, CHANGELOG.md, comments-only
- **Whitespace/formatting-only** - No logic changes, just style
- **Automated Dependabot bumps** - When they pass CI with no code modifications

**Note:** When in doubt, request review. It's better to over-review than under-review.

## Addressing Feedback

### MANDATORY Steps:

1. **Read ALL feedback** - Every comment from every AI reviewer
2. **Categorize by severity**:
   - üõë **Critical/High** - MUST fix before merge
   - ‚ö†Ô∏è **Medium** - Should fix or provide strong justification
   - üí° **Low/Info** - Consider, document if skipping
3. **Fix or respond** to EVERY item:
   - Fix the issue, OR
   - Reply explaining why you disagree with technical justification
4. **Re-request review** if you made significant changes
5. **Document** your decisions in the PR

### What "Fully Addressing" Means:

‚ùå **NOT acceptable:**
- Ignoring feedback
- Merging without responding
- Dismissing without justification
- "I'll fix it later"

‚úÖ **Acceptable:**
- Fixing the issue
- "This is intentional because [technical reason]"
- "False positive - [explanation with evidence]"
- "Out of scope for this PR - created issue #X"

## PR Owner Responsibilities

As PR owner, you MUST:
- Request AI review before merge
- Wait for reviews to complete
- Address every piece of feedback
- Not merge until feedback is resolved
- Document your merge decision

## Cross-Agent Collaboration & Conflict Resolution

### When Taking Over Another Agent's PR:
1. Request fresh AI review
2. Don't dismiss previous agent's decisions without justification
3. Tag original agent if making significant changes
4. Maintain the feedback resolution record

### Resolving AI-to-AI Conflicts:
When AI reviewers disagree with each other:
1. **Evaluate both positions** - Consider the technical merit of each
2. **Apply project conventions** - Use existing codebase patterns as tiebreaker
3. **Document your decision** - Explain which position you chose and why
4. **Prefer security/correctness** - When in doubt, choose the safer option
5. **Escalate if needed** - Tag human reviewer for genuinely ambiguous cases

## Merge Checklist

Before merging ANY PR:

- [ ] CI is green (all checks pass)
- [ ] At least ONE AI review requested (`/gemini review`, `/q review`, etc.)
- [ ] AI review completed (not pending)
- [ ] ALL critical/high severity items fixed
- [ ] ALL medium severity items fixed or justified with technical reasoning
- [ ] Responses posted to ALL feedback items (no ignored comments)
- [ ] No unresolved review threads
- [ ] Conflicts between AI reviewers resolved and documented

## Example Workflow

```bash
# 1. Create PR with conventional commit scope
gh pr create --title "fix(connectors): resolve API timeout issue"

# 2. Request AI reviews (post as PR comment)
# /gemini review
# /q review

# 3. Wait for reviews to complete (check PR page)

# 4. Address each piece of feedback
# - Fix code issues raised
# - Reply to every comment with fix or justification

# 5. If significant changes made, re-request review
# /gemini review

# 6. Verify merge checklist complete

# 7. Only after ALL feedback addressed:
gh pr merge --squash
```

## Enforcement

This is a **MANDATORY** protocol enforced as follows:

1. **Pre-merge gate** - Do not use `--admin` to bypass without AI review
2. **Audit trail** - All feedback and responses are recorded in PR history
3. **Revert policy** - PRs merged without proper review may be reverted
4. **Continuous improvement** - False positives from AI reviewers should be reported

The goal is **quality**, not speed. A well-reviewed PR that takes longer is better than a rushed merge that causes production issues.
