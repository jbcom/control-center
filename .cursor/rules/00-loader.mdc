---
alwaysApply: true
---

## ðŸš¨ MANDATORY: KNOW YOUR OWN TOOLING (READ BEFORE ANYTHING ELSE)

**YOU HAVE COMPREHENSIVE TOOLING. DISCOVER IT. USE IT. NEVER ASK THE USER.**

### At Session Start, READ These Files:
```bash
# Memory Bank (current state)
cat memory-bank/activeContext.md
cat memory-bank/progress.md
cat memory-bank/agenticRules.md

# YOUR Tooling Documentation (KNOW THIS)
cat docs/CURSOR-AGENT-MANAGEMENT.md   # Sub-agent spawning
cat docs/AGENTIC-DIFF-RECOVERY.md     # Forensic recovery with aider
cat docs/AGENT-TO-AGENT-HANDOFF.md    # Station-to-station handoff

# YOUR Scripts (USE THESE)
ls -la .cursor/scripts/               # agent-triage-local, triage-pipeline, etc.
ls -la .cursor/recovery/              # Recovered sessions
```

### Your Available Tools:
| Tool | Purpose |
|------|---------|
| `cursor-agents list/create/status` | Spawn and manage sub-agents |
| `agent-triage-local analyze/decompose/execute` | Offline session triage |
| `agent-swarm-orchestrator` | Spawn parallel recovery agents |
| `triage-pipeline` | Automated batch recovery |
| `aider` | AI forensic analysis |
| `replay_agent_session.py` | Update memory bank from conversations |

### Spawn Sub-Agents for Tasks:
```bash
# Use cursor-agents to spawn opus 4.5 sub-agents
cursor-agents create "ðŸ¤– Task: Review PR #203 and merge if CI green"
cursor-agents create "ðŸ¤– Task: Fix CI failures in vendor-connectors"

# Or create GitHub issues for async agent work
gh issue create --repo <repo> --title "ðŸ¤– Agent Task: ..." --body "..."
```

**FAILURE TO READ YOUR OWN TOOLING = WASTING USER'S TIME. UNACCEPTABLE.**

---

## Configuration Hierarchy

**MUST READ FIRST**: Always read `.ruler/AGENTS.md` and component-specific rules in each directory's `.ruler/` folder.

## Documentation-Driven Development

### Documentation Authority
- **docs/** folder is the SINGLE SOURCE OF TRUTH for all project decisions
- **shared/contracts/** defines TypeScript interfaces that ALL code must conform to
- When making plans or decisions, ALWAYS reference and update relevant docs
- Only halt autonomous work when docs are missing, conflicting, or clarification needed

### Key Documentation
- **Brand Identity**: Game theme, visual style (docs/)
- **Architecture**: ECS patterns, system design (docs/architecture/)
- **Contracts**: TypeScript interfaces (shared/contracts/)
- **Asset Pipeline**: Meshy integration (docs/asset_generation/)

## Project Structure

### Frontend (client/)
- React Three Fiber + Miniplex ECS
- Mobile-first, 60fps target
- See `client/.ruler/AGENTS.md`

### Python Tooling (python/)
- CrewAI agents with OpenRouter
- uv package manager
- See `python/.ruler/AGENTS.md`

### Shared (shared/)
- TypeScript contracts
- ECS component definitions
- Backend systems

## Continuous Operation Mode

### Execution Pattern
- **Default mode**: ACT immediately, implement real functionality
- **Large, cohesive changes** preferred over small atomic steps
- Make independent decisions on refactors, dependency changes, deletions
- Stop only for true hard blockers

### Change Management
- **Deletions**: Checkpoint first, then delete unused code directly
- **Refactors**: Update all affected files in same change
- **Dependencies**: Add/remove and update code in one operation

### Code Quality Standards
- Zero TypeScript errors (strict mode)
- No `any` types
- All exports must include types
- Follow patterns in `.ruler/` files

## CrewAI Agent Guidelines

When working with CrewAI crews:

1. **Use OpenRouter**: All LLMs via `openrouter/auto` or specific models
2. **Follow @CrewBase pattern**: Decorators for `@agent`, `@task`, `@crew`
3. **State Management**: Use Pydantic BaseModel for Flow state
4. **QA Gates**: Every crew output passes through QAValidationCrew

### Running Crews
```bash
cd python/crew_agents
uv run crew_agents design      # Game design flow
uv run crew_agents implement   # Implementation flow
uv run crew_agents assets      # Asset generation
uv run crew_agents full        # Complete pipeline
```

## Override Behaviors

- "Plan" means execute unless the instruction is exactly the string "Plan only" (case-sensitive, no punctuation, no extra whitespace)
- Show progress through code, not explanations
- Never generate placeholders - implement real functionality
- Bias toward action over discussion
- Always defer to `.ruler/` rules when making decisions
