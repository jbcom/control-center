# Active Context - jbcom Control Center

## Current Session (Nov 26, 2025)

### Primary Focus
Integrating vendor-connectors PyPI package into FlipsideCrypto/terraform-modules repository, replacing the incomplete cloud-connectors attempt and inline client implementations.

### Active Branch
`cursor/fix-all-ci-cd-issues-and-improve-release-process-claude-4.5-opus-high-thinking-2d3e` (this repo)

### External Work
- **terraform-modules**: `/workspace/external/terraform-modules` (branch: `fix/vendor-connectors-integration`)
- **Issues created**: #200, #201, #202

---

## jbcom Ecosystem Status

### PyPI Packages (All Released)
| Package | PyPI Name | Latest | Status |
|---------|-----------|--------|--------|
| extended-data-types | extended-data-types | 202511.x | ✅ Released |
| lifecyclelogging | lifecyclelogging | 202511.x | ✅ Released |
| directed-inputs-class | directed-inputs-class | 202511.x | ✅ Released |
| vendor-connectors | vendor-connectors | 202511.x | ✅ Released |

### CI/CD Status
- **Version**: Using pycalver (CalVer YYYY.MM.BUILD)
- **Workflow**: Unified ci.yml with reusable workflows
- **Build Tool**: uv workspace with uv sync/uv build/uv publish
- **All packages**: Publishing correctly to PyPI

### Dependency Graph
```
extended-data-types (FOUNDATION)
├── lifecyclelogging
├── directed-inputs-class
└── vendor-connectors (also depends on lifecyclelogging)
```

---

## Integration Target: terraform-modules

### Goal
Replace inline client implementations with vendor-connectors package.

### Completed Steps
1. ✅ Cloned terraform-modules to /workspace/external/terraform-modules
2. ✅ Created integration branch: fix/vendor-connectors-integration
3. ✅ Updated pyproject.toml with vendor-connectors dependency
4. ✅ Removed duplicate dependencies (boto3, hvac, etc.)
5. ✅ Deleted obsolete client files (aws_client.py, github_client.py, etc.)
6. ✅ Created GitHub issues for tracking (#200, #201, #202)

### Remaining Steps
- [ ] Update imports from cloud_connectors/local clients to vendor_connectors
- [ ] Update terraform_data_source.py connector usage
- [ ] Test tm_cli commands
- [ ] Create PR for terraform-modules
- [ ] Add deepmerge to extended-data-types (issue #201)
- [ ] Migrate secrets terraform wrappers (issue #202)
- [ ] Clone and refactor terraform-aws-secretsmanager

---

## Key Decisions Made

### CalVer Versioning
- Format: `YYYY.MM.BUILD` (e.g., 202511.42)
- Generated by pycalver at CI start
- Single version for entire monorepo push
- No git tags, no GitHub releases

### Package Management
- uv workspaces for monorepo structure
- All dev dependencies at workspace level
- uv sync --dev, uv build, uv publish in workflows

### Package Naming
- PyPI name is `vendor-connectors` (NOT cloud-connectors)
- Python import is `vendor_connectors`

---

## Authentication Quick Reference

### jbcom repos (this repo)
```bash
GH_TOKEN="$GITHUB_JBCOM_TOKEN" gh <command>
```

### FlipsideCrypto repos
```bash
# Default GITHUB_TOKEN works
gh <command>
```

---

## Files Recently Modified

### In jbcom-control-center
- `.github/workflows/ci.yml` - Fixed uv usage, pycalver, PyPI names
- `.github/workflows/reusable-*.yml` - Updated to use uv
- `pyproject.toml` - Fixed pycalver config, uv sources
- `packages/ECOSYSTEM.toml` - Corrected pypi_name for vendor-connectors
- `uv.lock` - Updated package references

### In terraform-modules
- `pyproject.toml` - Added vendor-connectors, removed duplicates
- Deleted: aws_client.py, github_client.py, google_client.py, slack_client.py, vault_client.py, zoom_client.py, vault_config.py, doppler_config.py

---

## Next Actions (In Order)
1. Update imports in terraform-modules to use vendor_connectors
2. Test tm_cli commands work with new imports
3. Create PR in terraform-modules
4. Add deepmerge to extended-data-types (new PR in jbcom-control-center)
5. Clone terraform-aws-secretsmanager
6. Refactor secrets lambdas to use vendor-connectors directly
