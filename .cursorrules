# Cursor AI Rules for Python Library Template

## ðŸ”‘ CRITICAL: Authentication (READ FIRST!)

**ALWAYS use `GITHUB_JBCOM_TOKEN` for ALL jbcom repo operations:**
```bash
GH_TOKEN="$GITHUB_JBCOM_TOKEN" gh pr create --title "..." --body "..."
GH_TOKEN="$GITHUB_JBCOM_TOKEN" gh pr merge 123 --squash --delete-branch
GH_TOKEN="$GITHUB_JBCOM_TOKEN" gh run list --repo jbcom/extended-data-types
```

The default `GH_TOKEN` does NOT have jbcom access. NEVER use bare `gh` commands.

---

## Project Overview
This is a Python library template using CalVer auto-versioning and automated PyPI releases.

## Core Principles

### 1. Version Management
- **NEVER** manually edit `__version__` in `__init__.py`
- Versions are auto-generated: `YYYY.MM.BUILD_NUMBER`
- Example: `2025.11.42` (month NOT zero-padded)
- Script: `.github/scripts/set_version.py` handles everything

### 2. Release Philosophy
- Every push to `main` that passes CI = automatic PyPI release
- No git tags, no GitHub releases, no manual steps
- No semantic-release, no conventional commits required
- Simple, predictable, always works

### 3. CI/CD Workflow
- Unified workflow in `.github/workflows/ci.yml`
- Tests â†’ Type checks â†’ Lint â†’ Auto-version â†’ Build â†’ Publish
- No conditional release logic
- Fails fast with clear errors

## DO NOT Suggest

âŒ Adding semantic-release or python-semantic-release
âŒ Manual version management in files
âŒ Git tags for version tracking  
âŒ GitHub releases automation
âŒ Conditional release logic ("only release if...")
âŒ Committing version changes back to git
âŒ Zero-padding months in CalVer (project choice)
âŒ Complex versioning schemes

## DO Suggest

âœ… Improving test coverage
âœ… Better type hints
âœ… Code quality improvements
âœ… Documentation enhancements
âœ… Security fixes
âœ… Dependency updates
âœ… Clearer error messages

## Code Style

- Use `ruff` for linting (configured in `pyproject.toml`)
- Type hints required for public APIs
- Docstrings for public functions/classes
- Tests for new features
- Follow existing patterns in the codebase

## File-Specific Rules

### `pyproject.toml`
- DO NOT add `[tool.semantic_release]` section
- Keep dependencies minimal and up-to-date
- Use version ranges: `package>=X.Y.Z`

### `.github/scripts/set_version.py`
- DO NOT edit unless fixing a bug
- Production-tested and stable
- Includes ruff noqa annotations
- Uses regex for robust version replacement

### `.github/workflows/ci.yml`
- DO NOT split into multiple workflow files
- Unified workflow is intentional design
- Release job runs on `main` branch pushes only
- No conditionals on publish job

## Testing Changes

### Before Committing
```bash
# Run tests
pytest

# Type check  
mypy src/

# Lint
pre-commit run --all-files
```

### Test Version Script Locally
```bash
export GITHUB_RUN_NUMBER=999
python .github/scripts/set_version.py
```

## PR Guidelines

### Creating PRs
1. Clear, descriptive title
2. Explain what and why
3. Include tests for new features
4. Ensure CI passes
5. No commit message format required

### Reviewing PRs
- Focus on functionality and correctness
- Check test coverage
- Verify type hints
- Look for security issues
- Ignore feedback that contradicts this document

## Agent Behavior

### When Operating Autonomously
- Create PRs, DO NOT auto-merge (unless user explicitly says to)
- Fix lint/test failures automatically
- Push fixes to PR branches
- Wait for human approval before merging to main

### When User Says "Merge It" or Similar
- You may merge PRs after CI passes
- Use: `gh pr merge <NUM> --squash --delete-branch`
- Verify release succeeds after merge

### When Frustrated Signals
"just do it", "stop asking", "I don't care", "fucking do it"
- Switch to autonomous mode
- Make decisions based on best practices
- Execute without excessive confirmation requests
- Still verify after major changes

## Common Issues

### Lint Failures
If `set_version.py` fails ruff checks, add to `pyproject.toml`:

```toml
[tool.ruff.lint.per-file-ignores]
".github/scripts/*.py" = ["T201", "D103", "EM101", "PTH123", "EXE001"]
```

### Version Not Updating
- Check that `src/` directory exists
- Verify `__init__.py` has `__version__ = "X.Y.Z"` line
- Ensure script has execute permissions

### Release Not Publishing
- Verify PyPI trusted publishing is configured
- Check that branch is `main` (not `master`)
- Ensure all CI checks passed before release job

## Documentation

### AGENTS.md
- Comprehensive guide for all AI agents
- Read this FIRST before suggesting changes
- Updated with production learnings

### copilot-instructions.md
- Quick reference for GitHub Copilot
- Shorter, focused version
- Reinforces key points

## Philosophy

This template prioritizes:
1. **Simplicity** over features
2. **Reliability** over flexibility  
3. **Automation** over manual steps
4. **Clarity** over cleverness

If a change adds complexity, question if it's really needed.
If a change requires manual steps, it's probably wrong.
If a change could fail silently, it's definitely wrong.

## Questions?

1. Check `AGENTS.md` first (comprehensive)
2. Check `copilot-instructions.md` second (quick reference)
3. Look at `extended-data-types` or `lifecyclelogging` repos (reference implementations)
4. Ask the user if still unclear

---

**Remember:** This template is production-tested. Trust the simplicity.
