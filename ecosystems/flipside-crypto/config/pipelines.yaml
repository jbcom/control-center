# Pipeline definitions for FlipsideCrypto infrastructure repositories
# Each pipeline generates files that are synced to the target repository

# =============================================================================
# ORGANIZATION ADMINISTRATION PIPELINES
# From: terraform-organization-administration
# =============================================================================
terraform-organization:
  # Proxy builder for multi-cloud organization management
  bootstrap_github_actions: true
  kms:
    enabled: true
  terraform:
    enabled: true
    generator:
      workspace:
        bind_to_context:
          state_path: "terraform/state/terraform-organization-administration/workspaces/secrets/terraform.tfstate"
          config_dir: "config"

# =============================================================================
# TERRAFORM ORGANIZATION PIPELINES  
# From: terraform-organization
# =============================================================================

# Compass - Multi-cloud networking
compass:
  use_sync: true
  terraform:
    enabled: true
    generator:
      workspace:
        root_dir: "terraform"
        bind_to_context:
          state_path: "terraform/state/terraform-aws-networks/workspaces/cluster-networking/Compass/terraform.tfstate"
          config_dir: "config"
    workspace:
      root_dir: "terraform"

# RStudio Data Science Environment
terraform-aws-rstudio:
  terraform:
    enabled: true
    backend:
      backend_bucket_workspaces_path: "terraform/state/data-science-architecture/workspaces"
    generator:
      workspace:
        bind_to_context:
          state_path: "terraform/state/terraform-aws-networks/workspaces/FlipsideCryptoRoot/terraform.tfstate"
          config_dir: "config"

# AWS Organization Structure
terraform-aws-organization:
  terraform:
    enabled: true
    generator:
      workspace:
        disable_vendors_module: true
        vendor_secrets_dir: "secrets"
        bind_to_context:
          state_path: "terraform/state/terraform-organization/workspaces/generator/terraform.tfstate"
          config_dir: "config"
    workspace:
      vendor_secrets_dir: "secrets"

# GitHub Organization Management
terraform-github-organization:
  terraform:
    enabled: true
    generator:
      workspace:
        bind_to_context:
          state_path: "terraform/state/terraform-organization/workspaces/generator/terraform.tfstate"
          config_dir: "config"
    workspace:
      providers:
        - "github"

# Google Cloud Organization
terraform-google-organization:
  terraform:
    enabled: true
    generator:
      workspace:
        providers:
          - "google"
          - "google-beta"
          - "googleworkspace"
        bind_to_context:
          state_path: "terraform/state/terraform-organization/workspaces/generator/terraform.tfstate"
          config_dir: "config"
    workspace:
      providers:
        - "google"
        - "google-beta"
        - "googleworkspace"

# Grafana Observability
terraform-grafana-architecture:
  terraform:
    enabled: true
    generator:
      workspace:
        providers:
          - "grafana"
        bind_to_context:
          state_path: "terraform/state/terraform-organization/workspaces/generator/terraform.tfstate"
          config_dir: "config"
    workspace:
      providers:
        - "grafana"

# AWS Networking
terraform-aws-networking:
  terraform:
    enabled: true
    backend:
      backend_bucket_workspaces_path: "terraform/state/terraform-aws-networks/workspaces"
    workspace:
      providers:
        - "github"
        - "datadog"

# AWS Monitoring
terraform-aws-monitoring:
  terraform:
    enabled: true

# AWS Secrets Manager
terraform-aws-secretsmanager:
  terraform:
    enabled: true
    backend:
      backend_bucket_workspaces_path: "terraform/state/secrets-architecture/workspaces"

# HashiCorp Vault
terraform-vault:
  terraform:
    enabled: true
    backend:
      backend_bucket_workspaces_path: "terraform/state/terraform-vault/workspaces"
    workspace:
      providers:
        - "google"
        - "hcp"
    workflow:
      workflow_name: vault
      use_oidc_auth: false

# Snowflake Data Platform
terraform-snowflake-architecture:
  terraform:
    enabled: true

# Fireblocks Treasury
fireblocks-architecture:
  terraform:
    enabled: true
    backend:
      backend_bucket_workspaces_path: "terraform/state/terraform-treasury/workspaces"
    generator:
      workspace:
        bind_to_context:
          state_path: "terraform/state/terraform-aws-networks/workspaces/treasury_fireblocks_cosigners/terraform.tfstate"
          config_dir: "config"
