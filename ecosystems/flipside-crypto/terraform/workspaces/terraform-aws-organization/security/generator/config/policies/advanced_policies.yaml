# Advanced Security Policies
# Detailed policy implementations for the security pipeline

# Advanced Service Control Policies
advanced_service_control_policies:
  # Restrict Region Usage
  restrict_regions:
    name: "RestrictRegions"
    description: "Restricts AWS service usage to approved regions"
    policy: |
      {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Sid": "DenyAllOutsideApprovedRegions",
            "Effect": "Deny",
            "NotAction": [
              "aws-portal:*",
              "budgets:*",
              "ce:*",
              "organizations:*",
              "iam:*",
              "kms:*",
              "support:*",
              "sts:*",
              "route53:*",
              "cloudfront:*",
              "globalaccelerator:*"
            ],
            "Resource": "*",
            "Condition": {
              "StringNotEquals": {
                "aws:RequestedRegion": [
                  "us-east-1",
                  "us-east-2",
                  "us-west-2"
                ]
              }
            }
          }
        ]
      }

  # Protect IAM Resources
  protect_iam_resources:
    name: "ProtectIAMResources"
    description: "Prevents modification of critical IAM resources"
    policy: |
      {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Sid": "ProtectCriticalRoles",
            "Effect": "Deny",
            "Action": [
              "iam:AttachRolePolicy",
              "iam:DeleteRole",
              "iam:DeleteRolePermissionsBoundary",
              "iam:DeleteRolePolicy",
              "iam:DetachRolePolicy",
              "iam:PutRolePermissionsBoundary",
              "iam:PutRolePolicy",
              "iam:UpdateAssumeRolePolicy",
              "iam:UpdateRole",
              "iam:UpdateRoleDescription"
            ],
            "Resource": [
              "arn:aws:iam::*:role/OrganizationAccountAccessRole",
              "arn:aws:iam::*:role/AWSControlTowerExecution"
            ]
          }
        ]
      }

# Tag Enforcement Policies
tag_enforcement_policies:
  # Required Tags Enforcement
  enforce_required_tags:
    name: "EnforceRequiredTags"
    description: "Enforces required tags on resource creation"
    policy: |
      {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Sid": "DenyResourcesWithoutRequiredTags",
            "Effect": "Deny",
            "Action": [
              "ec2:CreateTags",
              "ec2:RunInstances",
              "rds:CreateDBInstance",
              "s3:CreateBucket"
            ],
            "Resource": "*",
            "Condition": {
              "Null": {
                "aws:RequestTag/Environment": "true",
                "aws:RequestTag/Owner": "true"
              }
            }
          }
        ]
      }

# Security Tools Management Policies
security_tools_policies:
  # Guard Duty Protection
  guard_duty_protection:
    name: "GuardDutyProtection"
    description: "Prevents disabling or modifying GuardDuty"
    policy: |
      {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Sid": "ProtectGuardDuty",
            "Effect": "Deny",
            "Action": [
              "guardduty:DisassociateFromMasterAccount",
              "guardduty:DeleteDetector",
              "guardduty:DisableOrganizationAdminAccount"
            ],
            "Resource": "*"
          }
        ]
      }
  
  # Security Hub Protection
  security_hub_protection:
    name: "SecurityHubProtection"
    description: "Prevents disabling or modifying Security Hub"
    policy: |
      {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Sid": "ProtectSecurityHub",
            "Effect": "Deny",
            "Action": [
              "securityhub:DisableSecurityHub",
              "securityhub:DisassociateFromMasterAccount",
              "securityhub:DisassociateMembers",
              "securityhub:DisableOrganizationAdminAccount"
            ],
            "Resource": "*"
          }
        ]
      } 