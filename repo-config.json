{
  "$schema": "./schemas/repo-config.schema.json",
  "version": "1.0.0",
  "description": "Repository configuration - only fields we want to propagate",
  
  "defaults": {
    "_comment": "These are the ONLY settings we manage. Visibility and description are NEVER touched.",
    
    "merge_settings": {
      "allow_squash_merge": true,
      "allow_merge_commit": false,
      "allow_rebase_merge": false,
      "delete_branch_on_merge": true,
      "squash_merge_commit_title": "COMMIT_OR_PR_TITLE",
      "squash_merge_commit_message": "COMMIT_MESSAGES"
    },
    
    "features": {
      "has_issues": true,
      "has_projects": true,
      "has_wiki": false
    }
  },
  
  "rulesets": {
    "_comment": "Rulesets extracted from strata - applied to all repos",
    
    "main": {
      "name": "Main",
      "target": "branch",
      "enforcement": "active",
      "conditions": {
        "ref_name": {
          "include": ["~DEFAULT_BRANCH"],
          "exclude": []
        }
      },
      "bypass_actors": [
        {
          "actor_id": 5,
          "actor_type": "RepositoryRole",
          "bypass_mode": "always"
        }
      ],
      "rules": [
        { "type": "non_fast_forward" },
        { "type": "required_linear_history" },
        {
          "type": "pull_request",
          "parameters": {
            "allowed_merge_methods": ["squash"],
            "dismiss_stale_reviews_on_push": false,
            "require_code_owner_review": false,
            "require_last_push_approval": false,
            "required_approving_review_count": 0,
            "required_review_thread_resolution": true,
            "required_reviewers": []
          }
        }
      ]
    },
    
    "prs": {
      "name": "PRs",
      "target": "branch",
      "enforcement": "active",
      "conditions": {
        "ref_name": {
          "include": [],
          "exclude": ["refs/heads/main"]
        }
      },
      "bypass_actors": [],
      "rules": [
        {
          "type": "copilot_code_review",
          "parameters": {
            "review_draft_pull_requests": false,
            "review_on_push": true
          }
        },
        {
          "type": "copilot_code_review_analysis_tools",
          "parameters": {
            "tools": [
              { "name": "CodeQL" },
              { "name": "ESLint" }
            ]
          }
        },
        {
          "type": "code_quality",
          "parameters": {
            "severity": "errors"
          }
        }
      ]
    }
  },
  
  "ecosystems": {
    "python": {
      "files": {
        "always": ["always-sync", "python"],
        "initial": ["initial-only"]
      },
      "repos": [
        "agentic-crew",
        "vendor-connectors",
        "extended-data-types",
        "directed-inputs-class",
        "lifecyclelogging",
        "python-terraform-bridge",
        "rivers-of-reckoning",
        "ai_game_dev"
      ]
    },
    "nodejs": {
      "files": {
        "always": ["always-sync", "nodejs"],
        "initial": ["initial-only"]
      },
      "repos": [
        "agentic-control",
        "agentic-triage",
        "strata",
        "otter-river-rush",
        "otterfall",
        "rivermarsh",
        "pixels-pygame-palace"
      ]
    },
    "go": {
      "files": {
        "always": ["always-sync", "go"],
        "initial": ["initial-only"]
      },
      "repos": [
        "port-api",
        "vault-secret-sync",
        "secretsync"
      ]
    },
    "terraform": {
      "files": {
        "always": ["always-sync", "terraform"],
        "initial": ["initial-only"]
      },
      "repos": [
        "terraform-github-markdown",
        "terraform-repository-automation"
      ]
    }
  }
}
