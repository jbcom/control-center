# Ruler Configuration for jbcom Control Center
# Cross-platform AI agent instructions and MCP server definitions

# Default agents when --agents flag not specified
default_agents = ["copilot", "cursor", "claude", "aider", "cline", "windsurf", "codex", "roocode"]

# Enable nested rule loading for package-specific instructions
# This allows .ruler/ directories in packages/*/
nested = true

# --- Global MCP Configuration ---
[mcp]
enabled = true
merge_strategy = "merge"

# --- Global .gitignore Configuration ---
[gitignore]
enabled = true

# =============================================================================
# MCP SERVER DEFINITIONS (Shared by ALL agents)
# =============================================================================
# These servers are used by:
# - IDE agents (Cursor, Claude, Copilot, etc.) via stdio
# - CrewAI agents via mcp-proxy bridge (see process-compose.yml)
# - Background agents via CLI wrappers (see .cursor/scripts/mcp-bridge/)

# -----------------------------------------------------------------------------
# Core Development MCP Servers
# -----------------------------------------------------------------------------

[mcp_servers.filesystem]
command = "npx"
args = ["-y", "@modelcontextprotocol/server-filesystem", "/workspace"]

[mcp_servers.git]
command = "uvx"
args = ["mcp-server-git", "--repository", "/workspace"]

[mcp_servers.github]
command = "npx"
args = ["-y", "@modelcontextprotocol/server-github"]

[mcp_servers.github.env]
GITHUB_PERSONAL_ACCESS_TOKEN = "${GITHUB_JBCOM_TOKEN}"

[mcp_servers.memory]
command = "npx"
args = ["-y", "@modelcontextprotocol/server-memory"]

# -----------------------------------------------------------------------------
# Agent Memory & Context MCP Servers
# -----------------------------------------------------------------------------

[mcp_servers.conport]
command = "uvx"
args = [
  "--from", "context-portal-mcp",
  "conport-mcp",
  "--mode", "stdio",
  "--workspace_id", "/workspace",
  "--log-level", "INFO"
]

[mcp_servers.conport.env]
CONPORT_FILES = "projectBrief.md"

# Cursor Background Agent Manager - manage other Cursor agents
[mcp_servers.cursor_agents]
command = "cursor-background-agent-mcp-server"

[mcp_servers.cursor_agents.env]
CURSOR_API_KEY = "${CURSOR_API_KEY}"
CURSOR_WORKSPACE_ID = "${CURSOR_WORKSPACE_ID:-${PWD}}"

# Aider - AI pair programming for forensics and validation
[mcp_servers.aider]
command = "aider"
args = ["--mcp"]

[mcp_servers.aider.env]
ANTHROPIC_API_KEY = "${ANTHROPIC_API_KEY}"
OPENAI_API_KEY = "${OPENAI_API_KEY}"

# -----------------------------------------------------------------------------
# AWS Infrastructure MCP Servers
# -----------------------------------------------------------------------------
# VERIFIED: 2025-11-27 from https://github.com/awslabs/mcp

[mcp_servers.aws-iac]
command = "uvx"
args = ["awslabs.aws-iac-mcp-server@latest"]
# Infrastructure as Code: CloudFormation, CDK, best practices, security validation

[mcp_servers.aws-iac.env]
AWS_PROFILE = "${AWS_PROFILE:-default}"
AWS_REGION = "${AWS_REGION:-us-east-1}"
FASTMCP_LOG_LEVEL = "ERROR"

[mcp_servers.aws-serverless]
command = "uvx"
args = ["awslabs.aws-serverless-mcp-server@latest"]
# Serverless: Lambda, SAM, Step Functions, API Gateway

[mcp_servers.aws-serverless.env]
AWS_PROFILE = "${AWS_PROFILE:-default}"
AWS_REGION = "${AWS_REGION:-us-east-1}"
FASTMCP_LOG_LEVEL = "ERROR"

[mcp_servers.aws-api]
command = "uvx"
args = ["awslabs.aws-api-mcp-server@latest"]
# Direct AWS API access for any service

[mcp_servers.aws-api.env]
AWS_PROFILE = "${AWS_PROFILE:-default}"
AWS_REGION = "${AWS_REGION:-us-east-1}"
FASTMCP_LOG_LEVEL = "ERROR"

[mcp_servers.aws-cdk]
command = "uvx"
args = ["awslabs.cdk-mcp-server@latest"]
# AWS CDK development with compliance checks

[mcp_servers.aws-cdk.env]
FASTMCP_LOG_LEVEL = "ERROR"

[mcp_servers.aws-cfn]
command = "uvx"
args = ["awslabs.cfn-mcp-server@latest"]
# CloudFormation templates and stacks

[mcp_servers.aws-cfn.env]
AWS_PROFILE = "${AWS_PROFILE:-default}"
AWS_REGION = "${AWS_REGION:-us-east-1}"
FASTMCP_LOG_LEVEL = "ERROR"

[mcp_servers.aws-support]
command = "uvx"
args = ["awslabs.aws-support-mcp-server@latest"]
# AWS Support API access for case management

[mcp_servers.aws-support.env]
AWS_PROFILE = "${AWS_PROFILE:-default}"
AWS_REGION = "${AWS_REGION:-us-east-1}"
FASTMCP_LOG_LEVEL = "ERROR"

[mcp_servers.aws-pricing]
command = "uvx"
args = ["awslabs.aws-pricing-mcp-server@latest"]
# AWS Pricing API for cost analysis

[mcp_servers.aws-pricing.env]
AWS_REGION = "us-east-1"  # Pricing API only in us-east-1
FASTMCP_LOG_LEVEL = "ERROR"

[mcp_servers.billing-cost-management]
command = "uvx"
args = ["awslabs.billing-cost-management-mcp-server@latest"]
# Cost Explorer, Budgets, Cost and Usage Reports

[mcp_servers.billing-cost-management.env]
AWS_PROFILE = "${AWS_PROFILE:-default}"
AWS_REGION = "us-east-1"  # Billing only in us-east-1
FASTMCP_LOG_LEVEL = "ERROR"

[mcp_servers.aws-documentation]
command = "uvx"
args = ["awslabs.aws-documentation-mcp-server@latest"]
# Real-time access to official AWS documentation

[mcp_servers.aws-documentation.env]
FASTMCP_LOG_LEVEL = "ERROR"

# -----------------------------------------------------------------------------
# Google Cloud MCP Servers
# -----------------------------------------------------------------------------
# TODO: Add when available from https://github.com/google/mcp or similar
# For now, use gcloud CLI directly via background agent scripts

# -----------------------------------------------------------------------------
# Python Package Development MCP Servers
# -----------------------------------------------------------------------------

[mcp_servers.python-stdlib]
command = "npx"
args = ["-y", "@modelcontextprotocol/server-python-stdlib"]
# Python standard library documentation

# -----------------------------------------------------------------------------
# Agent-Specific Configurations
# -----------------------------------------------------------------------------

[agents.copilot]
enabled = true
output_path = ".github/copilot-instructions.md"

[agents.cursor]
enabled = true
# Uses default .cursorrules

[agents.cursor.mcp]
enabled = true
merge_strategy = "merge"

[agents.claude]
enabled = true
output_path = "CLAUDE.md"

[agents.cline]
enabled = true

[agents.windsurf]
enabled = true

[agents.aider]
enabled = true
output_path_instructions = "AGENTS.md"
output_path_config = ".aider.conf.yml"

[agents.zed]
enabled = true

[agents.kilocode]
enabled = true
output_path = ".kilocode/rules/ruler_kilocode_instructions.md"

[agents.codex]
enabled = true
output_path = ".codex/rules/ruler_codex_instructions.md"

[agents.roocode]
enabled = true
output_path = ".roo/rules/ruler_roocode_instructions.md"
