# Ruler Directory - AI Agent Instructions

This directory contains the **single source of truth** for all AI agent instructions across the jbcom Python library ecosystem.

## How Ruler Works

Ruler is a framework that:
1. **Centralizes** all AI agent instructions in `.ruler/*.md` files
2. **Concatenates** these files in a specific order
3. **Distributes** the combined content to agent-specific configuration files

### File Processing Order

Ruler processes files in this order:
1. `AGENTS.md` (if present) - always first
2. Remaining `.md` files in sorted order

Current files:
1. **AGENTS.md** - Core guidelines (SemVer/PSR workflow, common misconceptions)
2. **copilot.md** - Copilot-specific patterns and quick reference
3. **cursor.md** - Cursor agent modes, prompts, and workflows
4. **ecosystem.md** - Repository coordination and management

## Output Files

Ruler generates these files (DO NOT edit directly):

- **`.cursorrules`** - Cursor AI configuration
- **`.claud`** - Claude Code configuration
- **`.github/copilot-instructions.md`** - GitHub Copilot instructions
- **`AGENTS.md`** (root) - For Aider and general AI agents

All these files have a "Generated by Ruler" header and source comments.

## Making Changes

### To Update Agent Instructions

1. **Edit files in `.ruler/` directory**
   ```bash
   vim .ruler/AGENTS.md        # Core guidelines
   vim .ruler/cursor.md        # Cursor-specific
   vim .ruler/copilot.md       # Copilot patterns
   vim .ruler/ecosystem.md     # Ecosystem coordination
   ```

2. **Apply ruler to regenerate**
   ```bash
   ruler apply
   ```

3. **Review changes**
   ```bash
   git diff .cursorrules .github/copilot-instructions.md AGENTS.md
   ```

4. **Commit everything**
   ```bash
   git add .ruler/ .cursorrules .github/copilot-instructions.md AGENTS.md
   git commit -m "Update agent instructions via ruler"
   ```

### Configuration

Edit `.ruler/ruler.toml` to configure:
- Which agents are active by default
- Custom output paths for specific agents
- Nested rule loading (for subdirectory-specific rules)

Current configuration:
```toml
default_agents = ["copilot", "cursor", "claude", "aider"]

[agents.copilot]
enabled = true
output_path = ".github/copilot-instructions.md"

[agents.cursor]
enabled = true
# Uses default .cursorrules

[agents.claude]
enabled = true
# Uses default .claud

[agents.aider]
enabled = true
output_path_instructions = "AGENTS.md"
```

## File Purposes

### AGENTS.md
**Primary audience:** All AI agents
**Content:**
- python-semantic-release (PSR) workflow and rationale
- Why manual versioning is prohibited
- PR and release workflows
- Common agent misconceptions
- Development workflows
- Template maintenance guidelines

**Key sections:**
- CI/CD Design Philosophy
- Version Management
- Agent Approval Instructions
- Common Misconceptions

### copilot.md
**Primary audience:** GitHub Copilot
**Content:**
- Quick reference rules
- Code patterns and examples
- Testing patterns
- Common tasks (adding functions, fixing bugs, refactoring)
- Error message guidelines
- Security best practices

**Format:** Short, actionable examples with ✅/❌ comparisons

### cursor.md
**Primary audience:** Cursor AI
**Content:**
- Background agent modes (review, maintenance, migration, ecosystem)
- Custom prompts (`/ecosystem-status`, `/update-dependencies`, etc.)
- Error handling workflows
- Code style preferences
- Performance considerations
- Communication guidelines

**Format:** Operational guidelines for different work modes

### ecosystem.md
**Primary audience:** All agents doing cross-repo work
**Content:**
- Managed repository documentation
- Dependency graph
- Coordination guidelines
- Release coordination process
- Maintenance schedules
- Agent instructions for ecosystem work

**Format:** Reference documentation with procedures

## Best Practices

### Writing Agent Instructions

1. **Be explicit** - Don't assume agents understand context
2. **Use examples** - Show both good (✅) and bad (❌) patterns
3. **Explain why** - Not just what to do, but why it matters
4. **Anticipate mistakes** - Document common misconceptions
5. **Keep updated** - Revise based on agent behavior

### Organizing Content

- **General guidelines** → `AGENTS.md`
- **Agent-specific patterns** → `{agent}.md`
- **Domain-specific** → Separate files (e.g., `ecosystem.md`)
- **Quick reference** → Use bullet points and code examples
- **Deep explanations** → Use sections with rationale

### Testing Changes

After updating ruler content:

1. **Apply ruler**
   ```bash
   ruler apply
   ```

2. **Test with actual agents**
   - Ask Cursor to perform a task
   - Check if Copilot suggestions align
   - Verify agents follow new guidelines

3. **Iterate based on behavior**
   - If agents still make mistakes, clarify instructions
   - Add more examples if needed
   - Update misconceptions section

## Advanced Usage

### Dry Run

Preview what ruler will do:
```bash
ruler apply --dry-run
```

### Specific Agents

Apply only for certain agents:
```bash
ruler apply --agents copilot,cursor
```

### Verify Generated Files

After applying ruler, check that generated files:
1. Have "Generated by Ruler" header
2. Include all source files
3. Maintain proper formatting
4. Match expected structure

## Maintenance

### When to Update

Update ruler content when:
- Agents consistently misunderstand something
- New workflows or patterns emerge
- Ecosystem grows (new repos)
- Template changes significantly
- Agent tools/capabilities change

### Version History

Track changes to ruler content in git:
- Commit messages should explain what behavior changed
- Tag major instruction updates
- Document breaking changes for agents

### Testing Framework

Consider adding:
- Example prompts that test agent understanding
- Expected vs actual behavior documentation
- Agent response validation

## Integration with Template

This ruler setup is part of the python-library-template:

- **Template repos** - Use this exact structure
- **Managed repos** - Receive updates from template
- **Synchronization** - Ruler changes propagate via template updates

## Resources

- **Ruler Documentation:** https://github.com/intellectronica/ruler
- **Template Usage:** /workspace/TEMPLATE_USAGE.md
- **Ecosystem Guide:** /workspace/ECOSYSTEM.md

---

**Ruler Version:** Compatible with @intellectronica/ruler latest
**Last Updated:** 2025-11-25
**Maintained By:** python-library-template
