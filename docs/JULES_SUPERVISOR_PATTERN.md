# Jules Supervisor Pattern

This document outlines the pattern for a Cursor Cloud Agent to act as a "supervisor" for a Google Jules AI session. The supervisor's role is to manage the entire lifecycle of a pull request generated by Jules, from creation to merging.

## Environment Variables

Cursor Cloud Agents designated as supervisors will have access to the following environment variables:

| Variable              | Purpose                                       |
|-----------------------|-----------------------------------------------|
| `JULES_API_KEY`       | API key for accessing the Google Jules API.   |
| `CURSOR_GITHUB_TOKEN` | GitHub token for performing repository actions like merging PRs. |

## Orchestration Pattern

The supervisor agent follows a clear orchestration pattern to manage Jules-created pull requests effectively.

```
┌─────────────────────────────────────────────────────────────┐
│                  CURSOR CLOUD AGENT                         │
│                    (Supervisor)                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  1. List active Jules sessions                              │
│     GET /v1alpha/sessions                                   │
│                                                             │
│  2. Check session status                                    │
│     GET /v1alpha/sessions/{id}                              │
│                                                             │
│  3. When COMPLETED with PR:                                 │
│     - Check PR CI status                                    │
│     - Review AI feedback                                    │
│     - Handle any failing checks                             │
│     - Merge when ready                                      │
│                                                             │
│  4. For complex work, spawn additional:                     │
│     - Jules sessions (async refactoring)                    │
│     - Cursor Cloud Agents (long-running tasks)              │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

## Orchestrator Script

An orchestrator script is available to implement this pattern:

**Location:** `/workspace/scripts/cursor-jules-orchestrator.mjs`

**Usage:**
```bash
# Executed by a Cursor Cloud Agent
node scripts/cursor-jules-orchestrator.mjs
```

## Spawning Additional Agents

For complex tasks that require parallel work, the supervisor can spawn additional Cursor Cloud Agents.

**Example cURL Request:**
```bash
# Spawn a new agent to monitor a specific repository
curl -X POST 'https://api.cursor.com/agents/launch' \
  -u "$CURSOR_API_KEY:" \
  -d '{
    "repository": "jbcom/nodejs-strata",
    "task": "Monitor Jules PRs, handle reviews, and merge when ready.",
    "branch": "main"
  }'
```

## Workflow Steps

1.  **Jules Creates PR**: A Jules session completes and generates a pull request.
2.  **Supervisor Detection**: The Cursor supervisor agent detects the new PR.
3.  **CI/CD Checks**: The supervisor monitors the CI/CD pipeline for the PR.
    - If checks fail, the supervisor can attempt to fix them or delegate the task.
4.  **Review Feedback**: The supervisor addresses any feedback or comments on the PR.
5.  **Merge**: Once all checks pass and feedback is addressed, the supervisor merges the PR.
6.  **Task Delegation**: For complex issues, the supervisor can spawn sub-agents to handle specific tasks.

## Implementation Status

- [x] Created orchestrator script
- [ ] Add to agentic-control as proper module
- [ ] Create GitHub Action wrapper
- [ ] Add to control-center sync

## Related

- #422 (Unified Orchestrator EPIC)
- #427 (@agentic packages EPIC)
- #428 (Bulk delegation tracking)
