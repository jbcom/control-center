name: Lint Configuration

# Validates repo-config.json for correctness
# Runs on every PR and push to catch JSON errors early

on:
  pull_request:
    paths:
      - 'repo-config.json'
      - '.github/workflows/lint-config.yml'
  push:
    branches: [main]
    paths:
      - 'repo-config.json'
      - '.github/workflows/lint-config.yml'

permissions:
  contents: read

jobs:
  validate-json:
    name: Validate repo-config.json
    runs-on: ubuntu-latest
    
    steps:
      # actions/checkout v6.0.1
      - name: Checkout
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683
      
      - name: Check for symlinks
        run: |
          ./scripts/check-symlinks
      
      - name: Validate JSON configuration
        run: |
          # Use shared validation script
          ./scripts/validate-config --verbose
      
      - name: Display configuration summary
        run: |
          echo "Configuration Summary:"
          echo "====================="
          echo "Version: $(jq -r '.version' repo-config.json)"
          echo ""
          echo "Ecosystems:"
          jq -r '.ecosystems | to_entries[] | "  \(.key): \(.value.repos | length) repos"' repo-config.json
          echo ""
          echo "Total repositories: $(jq '[.ecosystems[].repos[]] | length' repo-config.json)"
