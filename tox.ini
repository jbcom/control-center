# Tox configuration for jbcom control center
# Runs tests across all packages in packages/

[tox]
env_list = 
    py39,py310,py311,py312,py313
    lint
    typecheck
min_version = 4.11
skip_missing_interpreters = true

# Base test environment
[testenv]
package = skip
deps =
    pytest>=8.0.0
    pytest-cov>=5.0.0
    pytest-xdist>=3.5.0
changedir = {toxinidir}
commands =
    # Test all packages
    pytest packages/extended-data-types/tests {posargs}
    pytest packages/lifecyclelogging/tests {posargs}
    pytest packages/directed-inputs-class/tests {posargs}
    pytest packages/vendor-connectors/tests {posargs}
setenv =
    PYTHONPATH = {toxinidir}/packages/extended-data-types/src:{toxinidir}/packages/lifecyclelogging/src:{toxinidir}/packages/directed-inputs-class/src:{toxinidir}/packages/vendor-connectors/src

# Individual package environments
[testenv:extended-data-types]
changedir = {toxinidir}/packages/extended-data-types
deps = 
    -e {toxinidir}/packages/extended-data-types[tests]
commands = pytest tests {posargs}

[testenv:lifecyclelogging]
changedir = {toxinidir}/packages/lifecyclelogging
deps = 
    -e {toxinidir}/packages/extended-data-types
    -e {toxinidir}/packages/lifecyclelogging[tests]
commands = pytest tests {posargs}

[testenv:directed-inputs-class]
changedir = {toxinidir}/packages/directed-inputs-class
deps = 
    -e {toxinidir}/packages/extended-data-types
    -e {toxinidir}/packages/directed-inputs-class[tests]
commands = pytest tests {posargs}

[testenv:vendor-connectors]
changedir = {toxinidir}/packages/vendor-connectors
deps = 
    -e {toxinidir}/packages/extended-data-types
    -e {toxinidir}/packages/lifecyclelogging
    -e {toxinidir}/packages/vendor-connectors[tests]
commands = pytest tests {posargs}

# Lint all packages
[testenv:lint]
skip_install = true
deps = ruff>=0.2.0
commands =
    ruff check packages/
    ruff format --check packages/

# Type check all packages
[testenv:typecheck]
skip_install = true
deps = 
    mypy>=1.8.0
    -e {toxinidir}/packages/extended-data-types[typing]
    -e {toxinidir}/packages/lifecyclelogging[typing]
commands =
    mypy packages/extended-data-types/src
    mypy packages/lifecyclelogging/src
